services:
  localstack:
    image: localstack/localstack
    container_name: localstack
    stop_grace_period: 1s
    ports:
      - "4566:4566"            
    environment:
      - SERVICES=secretsmanager
      - DEBUG=1
  anvil:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: anvil
    stop_grace_period: 1s
    ports:
      - "8545:8545"            
    command: anvil
    environment:
        ANVIL_IP_ADDR: 0.0.0.0
  postgres:
    image: postgres:latest
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=indexer_tests
  oprf-key-gen0:
    # this tag/sha must match the versions of taceo crates in Cargo.toml
    image: ghcr.io/taceolabs/oprf-service/oprf-key-gen:sha-1b0920299c3af921e96a58a61ae54f7113dc0cba
    network_mode: "host"
    environment:
      OPRF_NODE_ENVIRONMENT: dev
      OPRF_NODE_BIND_ADDR: 0.0.0.0:20000
      OPRF_NODE_OPRF_KEY_REGISTRY_CONTRACT: ${OPRF_NODE_OPRF_KEY_REGISTRY_CONTRACT}
      OPRF_NODE_CHAIN_WS_RPC_URL: ws://127.0.0.1:8545
      OPRF_NODE_RP_SECRET_ID_PREFIX: oprf/rp/n0
      OPRF_NODE_WALLET_PRIVATE_KEY_SECRET_ID: oprf/eth/n0
      OPRF_NODE_KEY_GEN_ZKEY: /app/OPRFKeyGen.13.arks.zkey
      OPRF_NODE_KEY_GEN_GRAPH: /app/OPRFKeyGenGraph.13.bin
      OPRF_NODE_TRANSACTION_CONFIRMATIONS: 1
      OPRF_NODE_DB_CONNECTION_STRING: postgres://postgres:postgres@localhost:5440/postgres
      OPRF_NODE_DB_SCHEMA: oprf
  oprf-key-gen1:
    # this tag/sha must match the versions of taceo crates in Cargo.toml
    image: ghcr.io/taceolabs/oprf-service/oprf-key-gen:sha-1b0920299c3af921e96a58a61ae54f7113dc0cba
    network_mode: "host"
    environment:
      OPRF_NODE_ENVIRONMENT: dev
      OPRF_NODE_BIND_ADDR: 0.0.0.0:20001
      OPRF_NODE_OPRF_KEY_REGISTRY_CONTRACT: ${OPRF_NODE_OPRF_KEY_REGISTRY_CONTRACT}
      OPRF_NODE_CHAIN_WS_RPC_URL: ws://127.0.0.1:8545
      OPRF_NODE_RP_SECRET_ID_PREFIX: oprf/rp/n1
      OPRF_NODE_WALLET_PRIVATE_KEY_SECRET_ID: oprf/eth/n1
      OPRF_NODE_KEY_GEN_ZKEY: /app/OPRFKeyGen.13.arks.zkey
      OPRF_NODE_KEY_GEN_GRAPH: /app/OPRFKeyGenGraph.13.bin
      OPRF_NODE_TRANSACTION_CONFIRMATIONS: 1
      OPRF_NODE_DB_CONNECTION_STRING: postgres://postgres:postgres@localhost:5441/postgres
      OPRF_NODE_DB_SCHEMA: oprf
  oprf-key-gen2:
    # this tag/sha must match the versions of taceo crates in Cargo.toml
    image: ghcr.io/taceolabs/oprf-service/oprf-key-gen:sha-1b0920299c3af921e96a58a61ae54f7113dc0cba
    network_mode: "host"
    environment:
      OPRF_NODE_ENVIRONMENT: dev
      OPRF_NODE_BIND_ADDR: 0.0.0.0:20002
      OPRF_NODE_OPRF_KEY_REGISTRY_CONTRACT: ${OPRF_NODE_OPRF_KEY_REGISTRY_CONTRACT}
      OPRF_NODE_CHAIN_WS_RPC_URL: ws://127.0.0.1:8545
      OPRF_NODE_RP_SECRET_ID_PREFIX: oprf/rp/n2
      OPRF_NODE_WALLET_PRIVATE_KEY_SECRET_ID: oprf/eth/n2
      OPRF_NODE_KEY_GEN_ZKEY: /app/OPRFKeyGen.13.arks.zkey
      OPRF_NODE_KEY_GEN_GRAPH: /app/OPRFKeyGenGraph.13.bin
      OPRF_NODE_TRANSACTION_CONFIRMATIONS: 1
      OPRF_NODE_DB_CONNECTION_STRING: postgres://postgres:postgres@localhost:5442/postgres
      OPRF_NODE_DB_SCHEMA: oprf
  oprf-node-db0:
    image: postgres:latest
    ports:
      - "5440:5432"
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
  oprf-node-db1:
    image: postgres:latest
    ports:
      - "5441:5432"
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
  oprf-node-db2:
    image: postgres:latest
    ports:
      - "5442:5432"
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres

